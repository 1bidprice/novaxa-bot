# NOVAXA Bot Token Management Safety Valve

## Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·

Î¤Î¿ NOVAXA Bot Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î¼Î¹Î± "Î´Î¹ÎºÎ»ÎµÎ¯Î´Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚" Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Î¿Ï… token Ï„Î¿Ï… Telegram bot. Î‘Ï…Ï„Î® Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Î½ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… bot Î½Î± ÎµÎ»Î­Î³Ï‡ÎµÎ¹ ÎºÎ±Î¹ Î½Î± Î±Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ token ÏŒÏ„Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹, Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ ÎµÏ€Î±Î½ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î® Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… ÎºÏÎ´Î¹ÎºÎ±.

## Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Token

### 1. Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•Ï€Î¹ÎºÏÏÏ‰ÏƒÎ· Token

ÎšÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·, Ï„Î¿ bot:
- Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î¿ format Ï„Î¿Ï… token
- Î•Ï€Î¹ÎºÏ…ÏÏÎ½ÎµÎ¹ Ï„Î¿ token Î¼Îµ Ï„Î¿ Telegram API
- Î”Î¹Î¿ÏÎ¸ÏÎ½ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÎºÎ¿Î¹Î½Î¬ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± format
- Î ÏÎ¿Ï„ÏÎ­Ï€ÎµÎ¹ Î³Î¹Î± Î½Î­Î¿ token Î±Î½ Ï„Î¿ Ï…Ï€Î¬ÏÏ‡Î¿Î½ ÎµÎ¯Î½Î±Î¹ Î¬ÎºÏ…ÏÎ¿

### 2. Î•Î½Ï„Î¿Î»Î­Ï‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Token (ÎœÏŒÎ½Î¿ Î³Î¹Î± Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·)

ÎŸ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚ Ï„Î¿Ï… bot Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ Î±ÎºÏŒÎ»Î¿Ï…Î¸ÎµÏ‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚:

- `/token` - Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï„Î¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ token
- `/token info` - Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ token
- `/token change <new_token>` - Î‘Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ token Ï„Î¿Ï… bot

### 3. Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î”Î¹Î±Î³ÏÎ±Ï†Î® Webhook

Î ÏÎ¹Î½ Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± polling, Ï„Î¿ bot:
- Î”Î¹Î±Î³ÏÎ¬Ï†ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Ï…Ï‡ÏŒÎ½ ÎµÎ½ÎµÏÎ³Î¬ webhooks
- Î‘Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ…Î³ÎºÏÎ¿ÏÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î±Î¾Ï polling ÎºÎ±Î¹ webhook
- Î”Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ bot Î¸Î± Î±Î½Ï„Î±Ï€Î¿ÎºÏÎ¯Î½ÎµÏ„Î±Î¹ ÏƒÏ‰ÏƒÏ„Î¬

## Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·

### Î•Ï€Î¹ÎºÏÏÏ‰ÏƒÎ· Token (fix_token.py)

```python
def validate_token_format(token):
    """Validate the format of a Telegram bot token."""
    if not token:
        return False, "Token is empty"
    
    parts = token.split(':')
    if len(parts) != 2:
        return False, "Token should contain exactly one colon (:)"
    
    bot_id, bot_hash = parts
    if not bot_id.isdigit():
        return False, "Bot ID part (before colon) should contain only digits"
    
    if len(bot_hash) < 30:
        return False, "Bot hash part (after colon) seems too short"
    
    return True, "Token format is valid"

def check_token_with_telegram(token, retries=3, delay=2):
    """Check if the token is valid by making a request to the Telegram API with retries."""
    for attempt in range(retries):
        try:
            url = f"https://api.telegram.org/bot{token}/getMe"
            response = requests.get(url, timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                if data.get('ok'):
                    bot_info = data.get('result', {})
                    return True, f"Token is valid! Bot: @{bot_info.get('username')} ({bot_info.get('first_name')})", bot_info
                else:
                    return False, f"API returned ok=false: {data.get('description', 'Unknown error')}", None
            elif response.status_code == 401:
                if attempt < retries - 1:
                    logging.warning(f"Token unauthorized (attempt {attempt+1}/{retries}). Retrying in {delay} seconds...")
                    time.sleep(delay)
                    continue
                return False, "Token is unauthorized. Please check if the token is correct or create a new one with BotFather.", None
            else:
                if attempt < retries - 1:
                    logging.warning(f"API returned status code {response.status_code} (attempt {attempt+1}/{retries}). Retrying in {delay} seconds...")
                    time.sleep(delay)
                    continue
                return False, f"API returned status code {response.status_code}: {response.text}", None
        except Exception as e:
            if attempt < retries - 1:
                logging.warning(f"Error checking token (attempt {attempt+1}/{retries}): {str(e)}. Retrying in {delay} seconds...")
                time.sleep(delay)
                continue
            return False, f"Error checking token: {str(e)}", None
    
    return False, "Failed after multiple attempts to validate token", None
```

### Î”Î¹Î±Î³ÏÎ±Ï†Î® Webhook (delete_webhook.py)

```python
def delete_webhook(token=None):
    """Delete the webhook for a Telegram bot."""
    if not token:
        load_dotenv()
        token = os.environ.get("TELEGRAM_BOT_TOKEN")
    
    if not token:
        logging.error("No token found")
        print("âŒ Error: No token found")
        return False
    
    try:
        url = f"https://api.telegram.org/bot{token}/deleteWebhook"
        response = requests.get(url, timeout=10)
        
        if response.status_code == 200:
            data = response.json()
            if data.get('ok'):
                logging.info("Webhook deleted successfully")
                print("âœ… Webhook deleted successfully")
                return True
            else:
                logging.error(f"Failed to delete webhook: {data.get('description', 'Unknown error')}")
                print(f"âŒ Failed to delete webhook: {data.get('description', 'Unknown error')}")
                return False
        else:
            logging.error(f"API returned status code {response.status_code}: {response.text}")
            print(f"âŒ API returned status code {response.status_code}: {response.text}")
            return False
    except Exception as e:
        logging.error(f"Error deleting webhook: {str(e)}")
        print(f"âŒ Error deleting webhook: {str(e)}")
        return False
```

### Î•Î½Ï„Î¿Î»Î­Ï‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Token (simple_bot.py)

```python
@bot.message_handler(commands=['token'])
def handle_token_command(message):
    """Handle token management commands."""
    user_id = message.from_user.id
    
    # Check if user is the owner
    if user_id != OWNER_ID:
        bot.reply_to(message, "â›” ÎœÏŒÎ½Î¿ Î¿ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚ Ï„Î¿Ï… bot Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï„Î¿ token.")
        return
    
    command_text = message.text.strip()
    args = command_text.split()
    
    if len(args) == 1:
        # Just /token command
        help_text = (
            "ğŸ” *Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Token (Î”Î¹ÎºÎ»ÎµÎ¯Î´Î± Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚)*\n\n"
            "Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚:\n"
            "â€¢ `/token info` - Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î³Î¹Î± Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ token\n"
            "â€¢ `/token change <new_token>` - Î‘Î»Î»Î±Î³Î® Ï„Î¿Ï… token Ï„Î¿Ï… bot\n\n"
            "Î‘Ï…Ï„Î® Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¿Î½ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… bot."
        )
        bot.reply_to(message, help_text, parse_mode='Markdown')
    elif len(args) >= 2:
        subcommand = args[1].lower()
        
        if subcommand == 'info':
            # Get token info
            load_dotenv()
            current_token = os.environ.get("TELEGRAM_BOT_TOKEN", "")
            
            if not current_token:
                bot.reply_to(message, "âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ token ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ .env")
                return
            
            # Mask the token for security
            masked_token = f"{current_token[:5]}...{current_token[-5:]}"
            
            # Check token with Telegram API
            valid, msg, bot_info = check_token_with_telegram(current_token)
            
            if valid and bot_info:
                info_text = (
                    f"âœ… *Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Token*\n\n"
                    f"â€¢ Token: `{masked_token}`\n"
                    f"â€¢ Bot Username: @{bot_info.get('username')}\n"
                    f"â€¢ Bot Name: {bot_info.get('first_name')}\n"
                    f"â€¢ Bot ID: {bot_info.get('id')}\n"
                    f"â€¢ ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: ÎˆÎ³ÎºÏ…ÏÎ¿ ÎºÎ±Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒ"
                )
            else:
                info_text = (
                    f"âš ï¸ *Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Token*\n\n"
                    f"â€¢ Token: `{masked_token}`\n"
                    f"â€¢ ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿\n"
                    f"â€¢ Î£Ï†Î¬Î»Î¼Î±: {msg}"
                )
            
            bot.reply_to(message, info_text, parse_mode='Markdown')
        
        elif subcommand == 'change':
            if len(args) < 3:
                bot.reply_to(message, "âŒ Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ Ï„Î¿ Î½Î­Î¿ token.\nÎ Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: `/token change 123456789:ABCdefGHIjklMNOpqrSTUvwxYZ`", parse_mode='Markdown')
                return
            
            new_token = args[2]
            
            # Validate token format
            format_valid, format_msg = validate_token_format(new_token)
            if not format_valid:
                bot.reply_to(message, f"âŒ ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ format token: {format_msg}\n\nÎ Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: `123456789:ABCdefGHIjklMNOpqrSTUvwxYZ`", parse_mode='Markdown')
                return
            
            # Check token with Telegram API
            valid, msg, bot_info = check_token_with_telegram(new_token)
            if not valid:
                bot.reply_to(message, f"âŒ ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ token: {msg}", parse_mode='Markdown')
                return
            
            # Update .env file with new token
            try:
                with open(".env", "r") as f:
                    env_content = f.read()
                
                # Get current token
                load_dotenv()
                current_token = os.environ.get("TELEGRAM_BOT_TOKEN", "")
                
                if current_token:
                    updated_content = env_content.replace(f"TELEGRAM_BOT_TOKEN={current_token}", f"TELEGRAM_BOT_TOKEN={new_token}")
                else:
                    if "TELEGRAM_BOT_TOKEN=" in env_content:
                        updated_content = env_content.replace("TELEGRAM_BOT_TOKEN=", f"TELEGRAM_BOT_TOKEN={new_token}")
                    else:
                        updated_content = env_content + f"\nTELEGRAM_BOT_TOKEN={new_token}\n"
                
                with open(".env", "w") as f:
                    f.write(updated_content)
                
                success_text = (
                    f"âœ… *Token ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!*\n\n"
                    f"â€¢ ÎÎ­Î¿ Bot: @{bot_info.get('username')} ({bot_info.get('first_name')})\n"
                    f"â€¢ Bot ID: {bot_info.get('id')}\n\n"
                    f"Î¤Î¿ bot Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Î³Î¹Î± Î½Î± ÎµÏ†Î±ÏÎ¼Î¿ÏƒÏ„ÎµÎ¯ Ï„Î¿ Î½Î­Î¿ token.\n"
                    f"Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ `./start_simple_bot.sh` Î³Î¹Î± ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·."
                )
                
                bot.reply_to(message, success_text, parse_mode='Markdown')
            except Exception as e:
                bot.reply_to(message, f"âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… token: {str(e)}")
        
        else:
            bot.reply_to(message, f"âŒ Î†Î³Î½Ï‰ÏƒÏ„Î· Ï…Ï€Î¿ÎµÎ½Ï„Î¿Î»Î®: {subcommand}\n\nÎ§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ `/token` Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚.", parse_mode='Markdown')
```

## Î”Î¹Î¬Î³ÏÎ±Î¼Î¼Î± Î¡Î¿Î®Ï‚ Î•ÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚ Bot

1. Î•ÎºÏ„Î­Î»ÎµÏƒÎ· `./start_simple_bot.sh`
2. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ±Î¹ Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· format token Î¼Îµ `fix_token.py`
3. Î”Î¹Î±Î³ÏÎ±Ï†Î® webhook Î¼Îµ `delete_webhook.py`
4. Î•ÎºÎºÎ¯Î½Î·ÏƒÎ· bot ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± polling Î¼Îµ `simple_bot.py`
5. Î‘Î½ Ï„Î¿ token ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿, Ï„Î¿ bot Î¾ÎµÎºÎ¹Î½Î¬ ÎºÎ±Î¹ Î±Î½Ï„Î±Ï€Î¿ÎºÏÎ¯Î½ÎµÏ„Î±Î¹ ÏƒÎµ ÎµÎ½Ï„Î¿Î»Î­Ï‚
6. Î‘Î½ Ï„Î¿ token ÎµÎ¯Î½Î±Î¹ Î¬ÎºÏ…ÏÎ¿, Î¶Î·Ï„ÎµÎ¯Ï„Î±Î¹ Î½Î­Î¿ token Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·

## Î Î»ÎµÎ¿Î½ÎµÎºÏ„Î®Î¼Î±Ï„Î± Ï„Î·Ï‚ "Î”Î¹ÎºÎ»ÎµÎ¯Î´Î±Ï‚ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚"

1. **Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±**: ÎœÏŒÎ½Î¿ Î¿ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï„Î¿ token
2. **Î•Ï…ÎµÎ»Î¹Î¾Î¯Î±**: Î•ÏÎºÎ¿Î»Î· Î±Î»Î»Î±Î³Î® token Ï‡Ï‰ÏÎ¯Ï‚ ÎµÏ€Î±Î½ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
3. **Î‘Î¾Î¹Î¿Ï€Î¹ÏƒÏ„Î¯Î±**: Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ· ÎºÎ±Î¹ Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Ï€ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½
4. **Î”Î¹Î±Ï†Î¬Î½ÎµÎ¹Î±**: Î Î»Î®ÏÎ·Ï‚ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î¿Ï… token
5. **Î£Ï…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î± Î¼Îµ Termux**: Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¬ÏˆÎ¿Î³Î± ÏƒÎµ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ ÎºÎ¹Î½Î·Ï„Î¿Ï

## Î‘Î½Ï„Î¹Î¼ÎµÏ„ÏÏ€Î¹ÏƒÎ· Î ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½

Î‘Î½ Ï„Î¿ bot Î´ÎµÎ½ Î±Î½Ï„Î±Ï€Î¿ÎºÏÎ¯Î½ÎµÏ„Î±Î¹:
1. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ token Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `/token info`
2. Î‘Î»Î»Î¬Î¾Ï„Îµ Ï„Î¿ token Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `/token change <new_token>`
3. Î•Ï€Î±Î½ÎµÎºÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î¿ bot Î¼Îµ `./start_simple_bot.sh`
